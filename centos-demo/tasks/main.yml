---
# tasks file for centos-demo
#
#
- name: configure yum repos - comment out mirrorlist
  shell: "sed -i 's/^mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*"
- name: configure yum repos - change baseurl
  shell: "sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*"

- name: download red hat gpg key
  get_url:
    dest: "/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release"
    url: "https://www.redhat.com/security/data/fd431d51.txt"
- name: download SSL cert for Red Hat CDN
  get_url:
    dest: "/etc/rhsm/ca/redhat-uep.pem"
    url: " https://ftp.redhat.com/redhat/convert2rhel/redhat-uep.pem"
- name: add the convert2rhel repo
  get_url:
    dest: "/etc/yum.repos.d/convert2rhel.repo"
    url: "https://ftp.redhat.com/redhat/convert2rhel/8/convert2rhel.repo"
- name: upgrade all packages
  yum:
    name: '*'
    state: latest
- name: install convert2rhel utility
  yum:
    name: "convert2rhel"
    state: latest
- name: disable convert2rhel repo
  lineinfile:
    path: /etc/yum.repos.d/convert2rhel.repo
    regexp: "enabled = 1"
    line: "enabled = 0"
    state: present
- name: update to a supported Kernel
  yum:
    name: kernel-core-4.18.0-348.7.1.el8_5
    state: present
- name: restart
  reboot:

